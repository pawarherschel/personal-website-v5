---
title: HyperV Shenanigans
published: 2025-04-13
description: This blog post covers how I created a Hyper-V VM from my laptop's NixOS Config flake along with all the errors and mistakes I made. I went through all of this trouble just so I won't have to start my laptop to rice and edit the config.
tags: [ ]
category: Programming
draft: false
prevTitle: "My journey with Typst"
prevSlug: "typst-journey"
nextTitle: ""
nextSlug: ""
---

# Introduction

I wanted to rice my laptop without turning it on,
so I thought, "Hey, I can just make a VM in Hyper-V",
because I didn't want to deal with VMWare or VirtualBox.
"I already use NixOS on WSL2, so I can just reuse the VHDX for the VM!",
or so I thought.
Then, quickly found out I can't just reuse it.

---

![img_1.png](/hyperv-shenanigans/img_1.png)

The dang thing doesn't even show a TTY!
Then, I remembered [github:nix-community/nixos-generators](https://github.com/nix-community/nixos-generators) exists.
Might as well use nixos generators, how hard can it be? It can't be that bad right? right???

Thus, as usual, I proceeded to fuck around and find out the age old lesson of:
:::Caution[TODO]
replace local link with CDN link 
:::

## Software Programming Mantra
![We do this not because it is easy, but because we thought it would be easy](/hyperv-shenanigans/mantra.svg "Software Programming Mantra")


:::note
I journaled the whole journey on Bluesky!

Check it out here: https://bsky.app/profile/sakurakat.systems/post/3llnz5asyms2c

<blockquote class="bluesky-embed" data-bluesky-uri="at://did:plc:rwi65xn77uzhgyewkfbuuziz/app.bsky.feed.post/3llnz5asyms2c" data-bluesky-cid="bafyreiglr2t5dl777thtxucftt5qlwbq6j57jftmwclktvjxjtnmanbd6e" data-bluesky-embed-color-mode="system"><p lang="en">trying to make a hyperv VM with nixos so i can rice my laptop without turning it on</p>&mdash; Kathryn&lt;&#x27;u1f338&gt; (<a href="https://bsky.app/profile/did:plc:rwi65xn77uzhgyewkfbuuziz?ref_src=embed">@sakurakat.systems</a>) <a href="https://bsky.app/profile/did:plc:rwi65xn77uzhgyewkfbuuziz/post/3llnz5asyms2c?ref_src=embed">March 31, 2025 at 2:39 PM</a></blockquote><script async src="https://embed.bsky.app/static/embed.js" charset="utf-8"></script>

You can also read the skeets as an article here: https://skywriter.blue/pages/did:plc:rwi65xn77uzhgyewkfbuuziz/post/3llnz5asyms2c 
:::

# Enter [github:nix-community/nixos-generators](https://github.com/nix-community/nixos-generators)

::github{repo="nix-community/nixos-generators"}

I first started by invoking `nixos-generator` and passed my nixos config via the `--flake` option.
I 
But, it kept saying `nixos/modules/virtualisation/disk-size-option.nix` is missing.

Now, I am new to flakes and Nix in general, so I couldn't figure out why it didn't find the option.

[//]: # (i used my laptop's config flake by using the \`--flake\` option)
[//]: # (it keeps saying \`nixos/modules/virtualisation/disk-size-option.nix\`)
[//]: # (is)
[//]: # (missing)
[//]: # (cant figure out how to add the option to my flake)
[//]: # (time to copy directly from the website ig)
[//]: # (it started building.... something, ig i need to wait now)
[//]: # (its creating the thingy ig but i just realized its creating the thingy)
[//]: # (using the wsl config and not my laptop config, oh well, atleast i now)
[//]: # (know that it works, gotta redo it once the image or whatever is built)
[//]: # (ofc as soon as i make the changes i want, it errors, time to copy)
[//]: # (again... pain)
[//]: # (the error was in the laptop's config part, ig ill just comment it out)
[//]: # (lol)
[//]: # (aaaaaaaand it says that nixosConfigurations is missing, time to bash)
[//]: # (my)
[//]: # (head against the wall)
[//]: # (.....fine ill just copy it one to one again)
[//]: # (oh i forgot to mention the system name, the system name for wsl is)
[//]: # (nixos)
[//]: # (&#40;default&#41;, since i didnt mention the system name while giving the)
[//]: # (flake)
[//]: # (as input, it assumed i wanted to build the thing using the system's)
[//]: # (system name, the fix was \`--flake .#kats-laptop\`)
[//]: # (finally got it to stop complaining about stuff, time to wait 30)
[//]: # (minutes)
[//]: # (again)
[//]: # (i wonder if 20gb is going to be enough for the vm, i kinda doubt it)
[//]: # (but)
[//]: # (i can hope)
[//]: # (it works! and it took 46m12s to build. I chose \`install-iso-hyperv\`)
[//]: # (as)
[//]: # (target out of curiosity and it always loads into the live iso, ig time)
[//]: # (to remake it with \`hyperv\` target)
[//]: # (Quota mode: disabled random cringe init done)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreica22d7j7in5ftidx47t3gmo6xfls6epxi4lpwkjxptghbjunpgpi@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 731 / 60;" loading="lazy")
[//]: # (alt="ystem with ordered data mode. Opts: . Quota mode: disabled.)
[//]: # (nixos-hyperv-hyperv&gt; [ 7.116506] random: crng init done" />)
[//]: # (i increased the image size from 20gb to 40gb and it keeps failing)
[//]: # (because it keeps running out of disk space, my guess is that wsl's)
[//]: # (disk)
[//]: # (size is too small to store 40gb)
[//]: # (gonna switch back to 20gb and hope it works now, if it doesnt then ill)
[//]: # (switch to something very small, like 5gb, and then see if i can)
[//]: # (increase)
[//]: # (the vdhx size in hyperv)
[//]: # (might also be a good candidate to see if i can use disko can format)
[//]: # (and)
[//]: # (do stuff for me instead of manually increasing the partition size and)
[//]: # (then reformatting and stuff)
[//]: # (disko: <a href="https://github.com/nix-community/disko")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">)
[//]: # (github.com</a>)
[//]: # (<a href="https://github.com/nix-community/disko")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (GitHub - nix-community/disko: Declarative disk partitioning and)
[//]: # (formatting using nix \[maintainers=Lassulus Enzime iFreilicht Mic92)
[//]: # (phaer\])
[//]: # (github.com)
[//]: # (all of this effort just because i dont want to turn on my laptop lol)
[//]: # (oh right, i didnt have the "out of space" problem before is because)
[//]: # (the)
[//]: # (target \`install-iso-hyperv\` as the name implies creates an iso, and)
[//]: # (the iso is ~2.6gb big)
[//]: # (another option to install nixos might be)
[//]: # (<a href="https://github.com/nix-community/nixos-anywhere")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">)
[//]: # (github.com</a>)
[//]: # (<a href="https://github.com/nix-community/nixos-anywhere")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (GitHub - nix-community/nixos-anywhere: Install NixOS everywhere via)
[//]: # (SSH)
[//]: # (\[maintainers=Mic92, Lassulus, phaer, Enzime\])
[//]: # (github.com)
[//]: # (20gb is too small for the thing ­ƒÖâ)
[//]: # (Model: &#40;file&#41; Disk /build/nixos.raw: 4295MB Sector size)
[//]: # (&#40;logical/physical&#41;: 512B/512B Partition Table: gpt Disk Flags: Number)
[//]: # (Start End Size File system Name Flags 1 8389kB 269MB 261MB fat32 ESP)
[//]: # (boot, esp 2 269MB 4294MB 4024MB ext4 primary)
[//]: # (wait, does it think 35\*1024 means 35mb???)
[//]: # (i changed it to 200\*1024 but it still gave the same error, maybe this)
[//]: # (line will help \> \[ 1.407725\] virtio_blk virtio0: \[vda\] 8388608)
[//]: # (512-byte logical blocks &#40;4.29 GB/4.00 GiB&#41;)
[//]: # (maybe the build sandbox is running out of space, and not wsl)
[//]: # (i can pass options to the nix build system via \`--option\` <a)
[//]: # (href="https://nix.dev/manual/nix/2.26/command-ref/nix-build.html#opt-option")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">nix.dev</a>)
[//]: # (and)
[//]: # (then,)
[//]: # (<a href="https://man.archlinux.org/man/nix.conf.5.en#conf-build-dir")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">)
[//]: # (man.archlinux.org</a>)
[//]: # (<a)
[//]: # (href="https://nix.dev/manual/nix/2.26/command-ref/nix-build.html#opt-option")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (nix-build - Nix Reference Manual)
[//]: # (nix.dev)
[//]: # (FINALLY A DIFFERENT ERROR error: builder for)
[//]: # (')
[//]: # (/nix/store/vvs9swrc5k75hbapav7wvshlsh1i5kgw-nixos-hyperv-hyperv-25.05.20250330.52faf48-x86_64-linux.drv')
[//]: # (failed with exit code 1)
[//]: # (but thats not an exit code in :/ <a)
[//]: # (href="https://nix.dev/manual/nix/2.26/command-ref/nix-build.html#special-exit-codes-for-build-failure")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">nix.dev</a>)
[//]: # (<a)
[//]: # (href="https://nix.dev/manual/nix/2.26/command-ref/nix-build.html#special-exit-codes-for-build-failure")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (nix-build - Nix Reference Manual)
[//]: # (nix.dev)
[//]: # (and the build-dir is empty)
[//]: # (it also says nixos-hyperv-hyperv\> error: creating file)
[//]: # ('")
[//]: # (/build/root/nix/store/gmj0qvnh5mhiz4hilis41snbmz0sz6k1-linux-pam-1.6.1-man/share/man/man8/pam.8.gz"':)
[//]: # (File exists)
[//]: # (lets gc the store and start the build again)
[//]: # (error: builder for)
[//]: # ('/nix/store/viir73fa9wxrbp4y18yad03nzp82bhjr-hwdb.bin.drv' failed with)
[//]: # (exit code 1)
[//]: # (error: 1 dependencies of derivation)
[//]: # ('/nix/store/7hmp6slgwlca392jg4lp329l9c7wwxi3-etc.drv' failed to build)
[//]: # (error: 1 dependencies of derivation)
[//]: # (')
[//]: # (/nix/store/ivrmw34kdm8p417kbihdjw83xxrkrwja-nixos-system-kats-laptop-hyperv-25.05.20250330.52faf48.drv')
[//]: # (failed to build)
[//]: # (error: 1 dependencies of derivation)
[//]: # (')
[//]: # (/nix/store/ivrmw34kdm8p417kbihdjw83xxrkrwja-nixos-system-kats-laptop-hyperv-25.05.20250330.52faf48.drv')
[//]: # (failed to build)
[//]: # (\*sigh\* idk anymore)
[//]: # (something in \`/etc\` according to)
[//]: # (<a)
[//]: # (href="https://bsky.app/profile/sakurakat.systems/post/3llojorn3tm2o")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">bsky.app</a>)
[//]: # (<a)
[//]: # (href="https://bsky.app/profile/did:plc:rwi65xn77uzhgyewkfbuuziz/post/3llojorn3tm2o")
[//]: # (class="max-w-2xl mx-auto flex flex-col border rounded-2xl gap-3 p-3)
[//]: # (md:p-5 md:gap-3 border-neutral-300 dark:border-neutral-800"></a>)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/avatar/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreihqy6ll3mkesekhkyuham7ojovrpzo5vcukn77pg6n4wgperkqkjy@jpeg")
[//]: # (class="w-10 h-10 md:w-12 md:h-12 rounded-full shrink-0" loading="lazy")
[//]: # (alt="Kathryn&lt;&#39;u1f338&gt;" />)
[//]: # (<div>)
[//]: # (Kathryn\<'u1f338\>)
[//]: # (@sakurakat.systems)
[//]: # (error: 1 dependencies of derivation)
[//]: # ('/nix/store/7hmp6slgwlca392jg4lp329l9c7wwxi3-etc.drv' failed to build)
[//]: # (March 31, 2025)
[//]: # (and something about hardware database?)
[//]: # (<a)
[//]: # (href="https://bsky.app/profile/sakurakat.systems/post/3llojor44um2o")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">bsky.app</a>)
[//]: # (<a)
[//]: # (href="https://bsky.app/profile/did:plc:rwi65xn77uzhgyewkfbuuziz/post/3llojor44um2o")
[//]: # (class="max-w-2xl mx-auto flex flex-col border rounded-2xl gap-3 p-3)
[//]: # (md:p-5 md:gap-3 border-neutral-300 dark:border-neutral-800"></a>)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/avatar/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreihqy6ll3mkesekhkyuham7ojovrpzo5vcukn77pg6n4wgperkqkjy@jpeg")
[//]: # (class="w-10 h-10 md:w-12 md:h-12 rounded-full shrink-0" loading="lazy")
[//]: # (alt="Kathryn&lt;&#39;u1f338&gt;" />)
[//]: # (<div>)
[//]: # (Kathryn\<'u1f338\>)
[//]: # (@sakurakat.systems)
[//]: # (error: builder for)
[//]: # ('/nix/store/viir73fa9wxrbp4y18yad03nzp82bhjr-hwdb.bin.drv' failed with)
[//]: # (exit code 1)
[//]: # (March 31, 2025)
[//]: # (i remember there was a module for some hardware optimisation for t480,)
[//]: # (maybe i turned it on? <a)
[//]: # (href="https://github.com/NixOS/nixos-hardware/blob/master/lenovo/thinkpad/t480/default.nix")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">)
[//]: # (github.com</a>)
[//]: # (<a)
[//]: # (href="https://github.com/NixOS/nixos-hardware/blob/master/lenovo/thinkpad/t480/default.nix")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (nixos-hardware/lenovo/thinkpad/t480/default.nix at master ┬À)
[//]: # (NixOS/nixos-hardware)
[//]: # (github.com)
[//]: # (nope, i dont see any of those options :/)
[//]: # (maybe its this line? \`boot.extraModprobeConfig = "options kvm_intel)
[//]: # (nested=1";\` lets just disable all the boot related option)
[//]: # (nope, lets turn on the option \`--option keep-failed true\` which)
[//]: # (saves)
[//]: # (failed artifacts and also \`--show-trace\` to see more detailed output)
[//]: # (<a href="https://www.man7.org/linux/man-pages/man7/hwdb.7.html")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:)
[//]: # (underline">www.man7.org</a>)
[//]: # (<a href="https://www.man7.org/linux/man-pages/man7/hwdb.7.html")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (hwdb&#40;7&#41; - Linux manual page)
[//]: # (www.man7.org)
[//]: # (note: keeping build directory)
[//]: # ('/mnt/d/build-dir/nix-build-perl-5.40.0-env.drv-0/build' note: keeping)
[//]: # (build directory)
[//]: # ('/mnt/d/build-dir/nix-build-initrd-linux-6.12.21.drv-0/build')
[//]: # (build-dir\nix-build-initrd-linux-6.12.21.drv-0\build\root\etc\modprobe.d)
[//]: # (has 3 files \`debian.conf\` \`nixos.conf\` \`ubuntu.conf\` and all of)
[//]: # (them are empty)
[//]: # (but initrd stuff is in hardware-configuration :/ and i commented out)
[//]: # (the)
[//]: # (code which would import it maybe the \`inherit system\` in the code i)
[//]: # (copied from website is causing problem?)
[//]: # (nope, something else)
[//]: # (since initrd seems to be part of the problem, lets turn on \`)
[//]: # (boot.loader.systemd-boot.enable = true;\`)
[//]: # (didnt do anything theres \`format = "raw"\` in the flake, lets change)
[//]: # (raw to hyperv)
[//]: # (nope, that didnt help either the mdadm files are also empty, i)
[//]: # (remember)
[//]: # (the name but i dont remember where)
[//]: # (<a href="https://www.man7.org/linux/man-pages/man8/mdadm.8.html")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:)
[//]: # (underline">www.man7.org</a>)
[//]: # (AH, i used that command when i was preparing for RHCSA, but why is it)
[//]: # (having problems there?)
[//]: # (<a href="https://www.man7.org/linux/man-pages/man8/mdadm.8.html")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (mdadm&#40;8&#41; - Linux manual page)
[//]: # (www.man7.org)
[//]: # (trying to make a basic hyperv vm instead of using my laptop's config)
[//]: # (lets just point to the config for now instead of flake...)
[//]: # (it failed again ­ƒÖâ)
[//]: # (idk, maybe it needs hardware-config.nix - nope! conflicting)
[//]: # (definitions)
[//]: # (lets try with the filesystem config commented out)
[//]: # (failed again)
[//]: # (ok, i just ran it without the build directory options and it works)
[//]: # (­ƒÖâ)
[//]: # (now lets try it with my laptop's config...)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreid4pk3ybt5tl46vyneabw4p7hzxjma4ega5t354igwsaguc6dq3ju@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 702 / 432;" loading="lazy")
[//]: # (alt="Hyper-V Manager An error occurred while attempting to start the)
[//]: # (selected virtual machine&#40;s&#41;. &#39;New Virtual Machine&#39; failed to)
[//]: # (start. Synthetic SCSI Controller &#40;Instance ID)
[//]: # (1666945F-9962-4366-83F3-AA863F98254B&#41;: Failed to Power on with Error)
[//]: # (&#39;The requested operation could not be completed due to a virtual)
[//]: # (disk system limitation. Virtual hard disk files must be uncompressed)
[//]: # (and unencrypted and must not be sparse.&#39;. Attachment &#39;D:)
[//]: # (\build-dir\nixos-image-hyperv-25.05pre-git-x86_64-linux.vhdx&#39;)
[//]: # (failed to open because of error: &#39;The requested operation could)
[//]: # (not be completed due to a virtual disk system limitation. Virtual hard)
[//]: # (disk files must be uncompressed and unencrypted and must not be)
[//]: # (sparse.&#39;." />)
[//]: # (oh right click file\>properties\>advanced\>uncheck Compress contents)
[//]: # (to)
[//]: # (save disk space lets try now)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreidbwwtsbbu4k6xhxpnncjz2b7fege7lox5muvd6zo6hn7onuxodwa@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="Microsoft Hyper-V UEFI Virtual Machine Boot Summary SCSI Disk &#40;)
[//]: # (0,0&#41; The unsigned image&#39;s hash is not allowed &#40;DB&#41; Network)
[//]: # (Adapter &#40;00155D006403&#41; A boot image was not found. No operating system)
[//]: # (was loaded. Your virtual machine may be configured incorrectly. Exit)
[//]: # (and re-configure your VM or click restart to retry the current boot)
[//]: # (sequence again." />)
[//]: # (oh, had to turn off secure boot in vm settings)
[//]: # (huh, whys my user not here)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreicswsqrydzmmec7yhxh5wpnv6zrctkxrbupnbfscdn4ezvw3klqkm@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="&lt;&lt;&lt; Welcome to NixOS hyperv-25.05pre-git &#40;x86_64&#41; - tty1)
[//]: # (&gt;&gt;&gt; Run ÔÇÿnixos-helpÔÇÖ for the NixOS manual. nixos login:)
[//]: # (root &#40;automatic login&#41; [root@nixos:~]# ls [root@nixos:~]# pwd)
[//]: # (/root [root@nixos:~]# Hyprland Hyprland: command not)
[//]: # (found [root@nixos:~]# sudo su ksakura No passwd entry for user)
[//]: # (&#39;ksakura&#39; [root@nixos:~]# sudo su kat No passwd entry for user)
[//]: # (&#39;kat&#39; [root@nixos:~]#" />)
[//]: # (maybe its the basic image?)
[//]: # (it created the same file, lets gc)
[//]: # (i just realized, the vhdx file is 4gb and this thing also shows 4gb)
[//]: # (<a)
[//]: # (href="https://bsky.app/profile/sakurakat.systems/post/3lloeoe3ylc2o")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">bsky.app</a>)
[//]: # (<a)
[//]: # (href="https://bsky.app/profile/did:plc:rwi65xn77uzhgyewkfbuuziz/post/3lloeoe3ylc2o")
[//]: # (class="max-w-2xl mx-auto flex flex-col border rounded-2xl gap-3 p-3)
[//]: # (md:p-5 md:gap-3 border-neutral-300 dark:border-neutral-800"></a>)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/avatar/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreihqy6ll3mkesekhkyuham7ojovrpzo5vcukn77pg6n4wgperkqkjy@jpeg")
[//]: # (class="w-10 h-10 md:w-12 md:h-12 rounded-full shrink-0" loading="lazy")
[//]: # (alt="Kathryn&lt;&#39;u1f338&gt;" />)
[//]: # (<div>)
[//]: # (Kathryn\<'u1f338\>)
[//]: # (@sakurakat.systems)
[//]: # (Model: &#40;file&#41; Disk /build/nixos.raw: 4295MB Sector size)
[//]: # (&#40;logical/physical&#41;: 512B/512B Partition Table: gpt Disk Flags: Number)
[//]: # (Start End Size File system Name Flags 1 8389kB 269MB 261MB fat32 ESP)
[//]: # (boot, esp 2 269MB 4294MB 4024MB ext4 primary)
[//]: # (March 31, 2025)
[//]: # (i removed the sudo and im back to this error error: path)
[//]: # (')
[//]: # (/nix/store/7a2rzcz3mjaq6ni71nn3zv6v3kxk8zab-nixpkgs/nixpkgs/nixos/modules/virtualisation/disk-size-option.nix')
[//]: # (does not exist)
[//]: # (i had an extra closing bracket....?)
[//]: # (ok finally got it to start building im not sure what i changed ;-;)
[//]: # (wait, if you use flake then does it build using the the nixos config)
[//]: # (just as \`nixos rebuild --flake\` does?)
[//]: # (i expect to get the error that the container is too small)
[//]: # (yup, go tit nixos-hyperv-hyperv\> ERROR: cptofs failed. diskSize might)
[//]: # (be too small for closure. error: builder for)
[//]: # (')
[//]: # (/nix/store/25wmmv6gscass1wmxan78npl169znd56-nixos-hyperv-hyperv-25.05.20250330.52faf48-x86_64-linux.drv')
[//]: # (failed with exit code 1;)
[//]: # (DIFFERENT HASH)
[//]: # (the vm takes more ram than i assigned)
[//]: # (huh, thats weird, why isnt it accepting the password?)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreiaipdjdei4ql6lfzct2to6k3cmbiwjtethfwe2sbmjuesutkvncya@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="kats-laptop login: ksakura Password: Login incorrect kats-laptop)
[//]: # (login: ksakura Password: Login incorrect kats-laptop login: _" />)
[//]: # (maybe it needs an initial password since /etc/passwd wont have the)
[//]: # (password hash or smt?)
[//]: # ("If none of the password options are set, then no password is assigned)
[//]: # (to the user, and the user will not be able to do password-based)
[//]: # (logins.")
[//]: # (<a)
[//]: # (href="https://mynixos.com/nixpkgs/option/users.users.%3Cname%3E.initialPassword#:~:text=If%20none%20of%20the%20password%20options%20are%20set%2C%20then%20no%20password%20is%20assigned%20to%20the%20user%2C%20and%20the%20user%20will%20not%20be%20able%20to%20do%20password%2Dbased%20logins")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">)
[//]: # (mynixos.com</a>.)
[//]: # (<a)
[//]: # (href="https://mynixos.com/nixpkgs/option/users.users.%3Cname%3E.initialPassword#:~:text=If%20none%20of%20the%20password%20options%20are%20set%2C%20then%20no%20password%20is%20assigned%20to%20the%20user%2C%20and%20the%20user%20will%20not%20be%20able%20to%20do%20password%2Dbased%20logins")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (users.users.\<name\>.initialPassword - MyNixOS)
[//]: # (mynixos.com)
[//]: # (<a)
[//]: # (href="https://discourse.nixos.org/t/hashing-plain-text-password-directly-in-configuration-nix/2093/6")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">)
[//]: # (discourse.nixos.org</a>)
[//]: # (<a)
[//]: # (href="https://discourse.nixos.org/t/hashing-plain-text-password-directly-in-configuration-nix/2093/6")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (Hashing plain-text password directly in configuration.nix)
[//]: # (discourse.nixos.org)
[//]: # (<a)
[//]: # (href="https://mynixos.com/nixpkgs/option/users.users.%3Cname%3E.hashedPassword")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">)
[//]: # (mynixos.com</a>)
[//]: # ("To generate a hashed password run mkpasswd.")
[//]: # (<a)
[//]: # (href="https://mynixos.com/nixpkgs/option/users.users.%3Cname%3E.hashedPassword")
[//]: # (class="max-w-2xl mx-auto block rounded-xl overflow-hidden)
[//]: # (bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-800 dark:hover:)
[//]: # (bg-neutral-700"></a>)
[//]: # (users.users.\<name\>.hashedPassword - MyNixOS)
[//]: # (mynixos.com)
[//]: # (<a)
[//]: # (href="https://bsky.app/profile/sakurakat.systems/post/3llqdmg7lml2g")
[//]: # (class="text-blue-500 dark:text-blue-300 hover:underline">bsky.app</a>)
[//]: # (Model: &#40;file&#41; Disk /build/nixos.raw: 21.5GB Sector size)
[//]: # (&#40;logical/physical&#41;: 512B/512B \[...\] Number Start End Size File)
[//]: # (system)
[//]: # (Name Flags 1 8389kB 269MB 261MB fat32 ESP boot, esp 2 269MB 21.5GB)
[//]: # (21.2GB ext4 primary)
[//]: # (<a)
[//]: # (href="https://bsky.app/profile/did:plc:rwi65xn77uzhgyewkfbuuziz/post/3llqdmg7lml2g")
[//]: # (class="max-w-2xl mx-auto flex flex-col border rounded-2xl gap-3 p-3)
[//]: # (md:p-5 md:gap-3 border-neutral-300 dark:border-neutral-800"></a>)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/avatar/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreihqy6ll3mkesekhkyuham7ojovrpzo5vcukn77pg6n4wgperkqkjy@jpeg")
[//]: # (class="w-10 h-10 md:w-12 md:h-12 rounded-full shrink-0" loading="lazy")
[//]: # (alt="Kathryn&lt;&#39;u1f338&gt;" />)
[//]: # (<div>)
[//]: # (Kathryn\<'u1f338\>)
[//]: # (@sakurakat.systems)
[//]: # (i just realized, the vhdx file is 4gb and this thing also shows 4gb)
[//]: # (bsky.app/profile/saku...)
[//]: # (April 1, 2025)
[//]: # (YES my suspicion was correct)
[//]: # (some stats because i want to post them it takes ~6m30s to rebuild the)
[//]: # (image and ~50s to copy the file to windows)
[//]: # (size of the vhdx file is 9.00 GB &#40;9,672,065,024 bytes&#41;)
[//]: # (HELL YEAH)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreie7acobfrnp5c2dkpsbmq3pkd6mdhv6npihbe7uegsd3iecrhaw7a@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen absolute")
[//]: # (loading="lazy")
[//]: # (alt="Screenshot of a Nushell terminal session showing configuration)
[//]: # (errors in the user&#39;s Nushell configuration files." />)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreicixum475hcrhwmcv5laxw6xrhm3jgjaszwtx6lnxuc42h22gzxqe@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen absolute")
[//]: # (loading="lazy")
[//]: # (alt="Screenshot of Hyprland window manager with compositor error)
[//]: # (message" />)
[//]: # (lets try to remove the errors from the config)
[//]: # (i did nix flake update which updated all the packages, so the vm is)
[//]: # (different compared to my laptop)
[//]: # (i guess i can just download the flake.lock file and then update it so)
[//]: # (its in sync with my laptop)
[//]: # (....huh? where are the config files?)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreif2k4redjlpyrpxjezbf2nhsb2blm5lsbzjxkcw3pocbp77oxiulm@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="terminal output saying that /etc/nixos is empty" />)
[//]: # (oh, i guess i made the image directly and didn't run the installer, so)
[//]: # (the config files arent present)
[//]: # (well, thats kinda annoying)
[//]: # (lets recreate the default config files first)
[//]: # (........ or i can just clone the repo and make the changes, i guess i)
[//]: # (need to change the hardware config, lets see what tools i can use)
[//]: # (\`nixos-generate-config\` looks promising)
[//]: # (yup! it works)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreicpx7kybglxnio4hkmfpozyn4i7lppxy5ucg3il3kxx2saj6txj54@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="running `ls /etc/nixos` shows 2 files, configuration.nix and)
[//]: # (hardware-configuration.nix" />)
[//]: # (determinate nix made the VM run out of memory ^^; maybe determinate)
[//]: # (nix)
[//]: # (isnt worth the trouble? lets just remove it for now and try again)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreie3bdsmdo3q7u55x4c4fvn2rschw7flc26lo2xgwkkdb7ni3dxvr4@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="output of `sudo nixos-rebuild test --flake .` shows system ran)
[//]: # (out of memory and consequently nix got killed while building)
[//]: # (determintate nix " />)
[//]: # (uh oh, out of space already!? running \`df -h\` says 100% used)
[//]: # (on \`/\`)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreihah3wlmgisqdtomgpe6p62ptgb3rdto2odiiuhvl5mg33inctdje@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="terminal output saying no space left on device" />)
[//]: # (well, thats easy to solve as this is a vm)
[//]: # (file \> settings \> hard drive \> edit \> aaaand expand disk after a)
[//]: # (reboot it should automatically detect the new space, and it does, i)
[//]: # (know)
[//]: # (because i'm writing this after doing it lol)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreidcaenbawfqzy47uxzxh6qx5e2k3kc562ae2xzmjidpwasxx4wvaa@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1550 / 839;" loading="lazy")
[//]: # (alt="hyper-v menu showing expand virtual hard disk" />)
[//]: # (no errors now C:)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreicrrdfoy6jtqfje6bugvvnpsacs7hnveywavqh7uy6w35vcmhuo4m@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="screenshot of the vm" />)
[//]: # (i guess the glitchiness is from hyprland struggling under VM which is)
[//]: # (expected)
[//]: # (two generations after restart! yippie!)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreicuysinhimujbym72bbts5idf2bf7zbkv7jj2dvucluk2klnwlpmu@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="bootloader showing two nixos generations" />)
[//]: # (lets see whats the problem with deterministic nix now...)
[//]: # (the vm has 10G of ram, so im not sure why the compilation failed)
[//]: # (huh? isnt it supposed to say deterministic nix? oh well, theres a 3rd)
[//]: # (boot entry and the compilation didnt fail)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreigdztuz46pb7aok5xv4qed44qwadveiymuxofadsn6tyaefkfirui@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="neofetch output" />)
[//]: # (determinate-nix says hello ­ƒÉ▒)
[//]: # (<img)
[//]: # (src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:rwi65xn77uzhgyewkfbuuziz/bafkreihnbovd5gevngqfe6k6pwndybslwicqw2l6ny6inmk2dynnury33m@jpeg")
[//]: # (class="inset-0 w-full h-full object-cover mix-blend-multiply dark:)
[//]: # (mix-blend-screen")
[//]: # (style="aspect-ratio: 1024 / 768;" loading="lazy")
[//]: # (alt="terminal output for determinate-nix which was successful" />)

---

- Link to the first skeet:
    - https://bsky.app/profile/sakurakat.systems/post/3llnz5asyms2c
- Read the thread on Skywriter.blue:
    - https://skywriter.blue/pages/did:plc:rwi65xn77uzhgyewkfbuuziz/post/3llnz5asyms2c

